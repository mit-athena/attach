#ifdef vax
CC=cc
#endif
#ifdef _AUX_SOURCE
XSRCS = emul_re.c
XOBJS = emul_re.o
#endif

BINDIR=/bin/athena

#if defined(ultrix)
LIBS = -lhesiod -lkrb -ldes -lzephyr -lcom_err $(XLIBS)
#else
LIBS = -lhesiod -lkrb -ldes -lrpcsvc -lzephyr -lcom_err $(XLIBS)
#endif

SRCS = main.c util.c attachtab.c attach.c detach.c mul.c nfs.c rvd.c\
	afs.c ufs.c rpc.c mount.c unmount.c zephyr.c getrealm.c\
	rvdutil.c pathcan.c config.c strtok.c $(XSRCS)
OBJS = 	main.o util.o attachtab.o attach.o detach.o mul.o nfs.o rvd.o\
	afs.o ufs.o rpc.o mount.o unmount.o zephyr.o getrealm.o\
	rvdutil.o pathcan.o config.o strtok.o $(XOBJS)


build_program(attach,$(OBJS),,$(LIBS))
install_program(attach,-m 4755 -o root,$(BINDIR)/)

install_man(attach.1,attach.1)
install_man(detach.1,detach.1)
install_man(fsid.1,fsid.1)
install_man(nfsid.1,nfsid.1)
install_man(attach.conf.5,attach.conf.5)
install_man(attachtab.5,attachtab.5)
install_man(zinit.8,zinit.8)

install::
	rm -f $(DESTDIR)$(BINDIR)/detach
	rm -f $(DESTDIR)$(BINDIR)/fsid
	rm -f $(DESTDIR)$(BINDIR)/nfsid
	rm -f $(DESTDIR)/etc/athena/zinit
	ln -s attach $(DESTDIR)$(BINDIR)/detach
	ln -s attach $(DESTDIR)$(BINDIR)/fsid
	ln -s attach $(DESTDIR)$(BINDIR)/nfsid
	ln -s $(BINDIR)/attach $(DESTDIR)/etc/athena/zinit
