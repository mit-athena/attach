AnsiCC()

#if !defined(ultrix)
RPCLIB=-lrpcsvc
#endif

#ifdef SOLARIS
BSDLIB = -lbsd
#endif

#ifdef sgi
XLIBS=-lregex
#endif

LIBS = $(BSDLIB) -lhesiod $(RPCLIB) -lzephyr -lkrb4 -ldes425 -lkrb5 -lcrypto \
	-lcom_err -lathdir $(XLIBS) 

SRCS = main.c util.c attachtab.c attach.c detach.c mul.c nfs.c rvd.c\
	afs.c ufs.c rpc.c mount.c unmount.c zephyr.c add.c stringlist.c\
	getrealm.c rvdutil.c pathcan.c config.c $(XSRCS)
OBJS = 	main.o util.o attachtab.o attach.o detach.o mul.o nfs.o rvd.o\
	afs.o ufs.o rpc.o mount.o unmount.o zephyr.o add.o stringlist.o\
	getrealm.o rvdutil.o pathcan.o config.o $(XOBJS)

build_program(attach,$(OBJS),,$(LIBS))
install_program(attach,-m 4755 -o root -s,$(ATHRBINDIR))

install_man(add.1,add.1)
install_man(attach.1,attach.1)
install_man(attachandrun.1,attachandrun.1)
install_man(detach.1,detach.1)
install_man(fsid.1,fsid.1)
install_man(attach.conf.5,attach.conf.5)
install_man(attachtab.5,attachtab.5)
install_man(zinit.8,zinit.8)

install_man_links(fsid.1,nfsid.1)

install::
	$(RM) $(DESTDIR)$(ATHRBINDIR)/attachandrun
	$(RM) $(DESTDIR)$(ATHRBINDIR)/detach
	$(RM) $(DESTDIR)$(ATHRBINDIR)/fsid
	$(RM) $(DESTDIR)$(ATHRBINDIR)/nfsid
	$(RM) $(DESTDIR)$(ATHRBINDIR)/zinit
	$(RM) $(DESTDIR)$(ATHRETCDIR)/zinit
	ln -s attach $(DESTDIR)$(ATHRBINDIR)/attachandrun
	ln -s attach $(DESTDIR)$(ATHRBINDIR)/detach
	ln -s attach $(DESTDIR)$(ATHRBINDIR)/fsid
	ln -s attach $(DESTDIR)$(ATHRBINDIR)/nfsid
	ln -s attach $(DESTDIR)$(ATHRBINDIR)/zinit
	ln -s $(ATHRBINDIR)/attach $(DESTDIR)$(ATHRETCDIR)/zinit
